# ZettAI 破産手続支援SaaS：権限・ロール定義書

---

## 目次

1. [ロール一覧](#1-ロール一覧)
2. [権限マトリクス](#2-権限マトリクス)
3. [各ロールの詳細定義](#3-各ロールの詳細定義)
4. [RACI表（責任分界）](#4-raci表責任分界)
5. [アクセス制御ルール](#5-アクセス制御ルール)
6. [監査・異常検知](#6-監査異常検知)

---

## 1. ロール一覧

### 1-1. システムロール

| ロールID | ロール名 | 所属 | 説明 |
|----------|----------|------|------|
| `LAWYER` | 弁護士 | 弁護士法人 | 法的判断・承認・対外送信の権限を持つ |
| `STAFF` | 事務職員 | 弁護士法人 | 依頼者対応・資料管理の権限を持つ |
| `CLIENT` | 依頼者 | - | 自分の案件の閲覧・資料提出の権限を持つ |
| `TECH_SUPPORT` | 技術サポート | ZettAI | システム保守・障害対応の権限を持つ |
| `ADMIN` | システム管理者 | 弁護士法人 | ユーザー管理・設定変更の権限を持つ |

### 1-2. ロールの階層

```
弁護士法人
├── ADMIN（システム管理者）
│     └── ユーザー管理、設定変更
├── LAWYER（弁護士）
│     └── 全案件の閲覧、承認、送信
└── STAFF（事務職員）
      └── 担当案件の閲覧、依頼者対応

ZettAI
└── TECH_SUPPORT（技術サポート）
      └── システム保守、障害時のみアクセス

依頼者
└── CLIENT（依頼者）
      └── 自分の案件のみ閲覧・操作
```

---

## 2. 権限マトリクス

### 2-1. 機能別権限

| 機能 | LAWYER | STAFF | CLIENT | TECH_SUPPORT | ADMIN |
|------|--------|-------|--------|--------------|-------|
| **案件閲覧（全件）** | ✅ | ❌ | ❌ | ❌ | ✅ |
| **案件閲覧（担当のみ）** | ✅ | ✅ | ✅（自分のみ） | ❌ | ✅ |
| **案件作成** | ✅ | ✅ | ❌ | ❌ | ✅ |
| **利益相反チェック判断** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **受任可否判断** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **AIドラフトの閲覧** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **AIドラフトの承認** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **AIドラフトの修正** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **対外送信（依頼者へ）** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **対外送信（債権者へ）** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **対外送信（裁判所へ）** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **依頼者への事務連絡** | ✅ | ✅ | ❌ | ❌ | ❌ |
| **資料アップロード** | ✅ | ✅ | ✅ | ❌ | ❌ |
| **資料閲覧** | ✅ | ✅ | ✅（自分のみ） | ❌ | ❌ |
| **監査ログ閲覧** | ✅ | ❌ | ❌ | ✅（障害時） | ✅ |
| **ユーザー管理** | ❌ | ❌ | ❌ | ❌ | ✅ |
| **システム設定** | ❌ | ❌ | ❌ | ✅ | ✅ |

### 2-2. 送信権限の詳細（送信ゲート）

| 送信種別 | LAWYER | STAFF | CLIENT | TECH_SUPPORT |
|----------|--------|-------|--------|--------------|
| **法的回答（依頼者向け）** | ✅ | ❌ | - | ❌ |
| **受任通知（債権者向け）** | ✅ | ❌ | - | ❌ |
| **申立書（裁判所向け）** | ✅ | ❌ | - | ❌ |
| **補正書面（裁判所向け）** | ✅ | ❌ | - | ❌ |
| **資料提出リマインド** | ✅ | ✅ | - | ❌ |
| **日程調整連絡** | ✅ | ✅ | - | ❌ |
| **技術サポート連絡** | ❌ | ❌ | - | ✅（テンプレのみ） |

---

## 3. 各ロールの詳細定義

### 3-1. LAWYER（弁護士）

**所属：** 弁護士法人柳田

**責任範囲：**
- 法的判断・方針決定の最終責任
- 対外送信（依頼者・債権者・裁判所）の実行責任
- AIドラフトの確認・承認責任

**できること：**
- 全案件の閲覧・操作
- 利益相反チェック・受任可否の判断
- AIドラフトの確認・修正・承認
- 依頼者・債権者・裁判所への送信実行
- 監査ログの閲覧

**できないこと：**
- ユーザー管理（ADMIN権限が必要）
- システム設定の変更

**アカウント要件：**
- 多要素認証（MFA）必須
- 弁護士登録番号との紐付け
- 定期的なパスワード変更

---

### 3-2. STAFF（事務職員）

**所属：** 弁護士法人柳田

**責任範囲：**
- 依頼者対応（事務連絡に限定）
- 資料収集・整理のサポート
- リマインド・日程調整

**できること：**
- 担当案件の閲覧
- 依頼者への事務連絡送信
- 資料のアップロード・閲覧
- リマインドの管理

**できないこと：**
- 法的判断を含む回答の送信
- AIドラフトの閲覧・承認
- 債権者・裁判所への送信
- 利益相反チェック・受任判断
- 監査ログの閲覧

**送信可能な内容（テンプレート制限）：**
- 資料提出のお願い
- 提出期限のリマインド
- 面談日程の調整
- 受領確認の連絡
- 一般的な手続き案内

**送信不可能な内容：**
- 法的見解・方針の説明
- 「破産が適切」等の判断
- 免責の見通し
- 債権者への通知・交渉

---

### 3-3. CLIENT（依頼者）

**所属：** なし（弁護士法人の顧客）

**責任範囲：**
- 正確な情報の提供
- 必要資料の提出
- 連絡への応答

**できること：**
- 自分の案件情報の閲覧
- 資料のアップロード
- ヒアリング質問への回答
- 弁護士からのメッセージ確認
- 進捗状況の確認

**できないこと：**
- 他の依頼者の情報閲覧
- 案件の作成・編集
- 弁護士・事務職員用画面へのアクセス

**アカウント要件：**
- メールアドレス認証
- パスワード設定
- オプションでMFA

---

### 3-4. TECH_SUPPORT（技術サポート）

**所属：** ZettAI株式会社

**責任範囲：**
- システムの技術的保守
- 障害発生時の対応
- セキュリティ監視

**できること（通常時）：**
- システムログの閲覧（案件内容を除く）
- システム設定の変更
- パフォーマンス監視

**できること（障害時・柳田承認後）：**
- 案件データへのアクセス（障害調査目的に限定）
- 監査ログの閲覧

**できないこと：**
- 案件内容の閲覧（通常時）
- 依頼者への直接連絡（法的内容）
- AIドラフトの閲覧・操作
- 送信の実行

**依頼者に接触する場合の制限：**
- 完全に非法律の事務連絡テンプレのみ
  - 「ログイン方法のご案内」
  - 「パスワードリセット手順」
  - 「ファイルアップロードの方法」
- 案件内容・法的事項には一切触れない
- 「ZettAI技術サポート」として明示

---

### 3-5. ADMIN（システム管理者）

**所属：** 弁護士法人柳田

**責任範囲：**
- ユーザーアカウントの管理
- ロール・権限の割り当て
- システム設定の管理

**できること：**
- ユーザーの追加・削除・編集
- ロールの割り当て変更
- システム設定の変更
- 全案件の閲覧
- 監査ログの閲覧

**できないこと：**
- LAWYERロール固有の操作（ADMINのみでは不可）
  - 法的判断
  - 対外送信（LAWYERロールも必要）

**運用ルール：**
- ADMINロールは弁護士が兼務することを推奨
- または、弁護士の監督下で事務職員が担当

---

## 4. RACI表（責任分界）

### 4-1. 案件処理業務

| 業務 | LAWYER | STAFF | CLIENT | TECH_SUPPORT |
|------|--------|-------|--------|--------------|
| **相談受付（一次対応）** | I | R | - | - |
| **利益相反チェック** | A/R | I | - | - |
| **受任可否判断** | A/R | I | - | - |
| **委任契約締結** | A/R | C | R | - |
| **事前ヒアリング** | A | R | R | - |
| **資料収集・リマインド** | A | R | R | - |
| **AIドラフト確認** | A/R | - | - | - |
| **AIドラフト承認** | A/R | - | - | - |
| **依頼者への法的回答** | A/R | - | I | - |
| **依頼者への事務連絡** | A | R | I | - |
| **受任通知送付** | A/R | I | I | - |
| **申立書提出** | A/R | I | I | - |

**凡例：**
- R = Responsible（実行責任）
- A = Accountable（説明責任・最終責任）
- C = Consulted（相談先）
- I = Informed（報告先）

### 4-2. システム運用業務

| 業務 | LAWYER | STAFF | ADMIN | TECH_SUPPORT |
|------|--------|-------|-------|--------------|
| **ユーザー管理** | I | I | A/R | C |
| **システム設定** | I | I | A | R |
| **障害対応（初動）** | I | I | I | A/R |
| **障害対応（案件影響）** | A/C | I | I | R |
| **セキュリティ監視** | I | - | I | A/R |
| **監査ログ点検** | A/R | - | R | C |
| **定期バックアップ** | I | - | I | A/R |

---

## 5. アクセス制御ルール

### 5-1. 認証要件

| ロール | パスワード | MFA | セッション時間 | IP制限 |
|--------|-----------|-----|---------------|--------|
| LAWYER | 必須（強度要件あり） | 必須 | 8時間 | オプション |
| STAFF | 必須（強度要件あり） | 推奨 | 8時間 | オプション |
| CLIENT | 必須 | オプション | 24時間 | なし |
| TECH_SUPPORT | 必須（強度要件あり） | 必須 | 4時間 | 必須 |
| ADMIN | 必須（強度要件あり） | 必須 | 4時間 | オプション |

### 5-2. データアクセス制御

**テナント分離：**
- 弁護士法人ごとにデータを完全分離
- 他テナントのデータには一切アクセス不可

**案件レベルのアクセス制御：**
- CLIENT：自分の案件のみ
- STAFF：担当案件のみ（割り当てベース）
- LAWYER：所属事務所の全案件
- TECH_SUPPORT：原則アクセス不可（障害時は承認フロー経由）

### 5-3. ZettAIのアクセス制限（重要）

**原則：**
- ZettAIは案件内容にアクセスしない
- 技術保守に必要な範囲のシステムログのみ

**障害時のアクセス手順：**

```
1. 障害発生・検知
        ↓
2. ZettAI → 柳田に閲覧申請（理由・範囲を明記）
        ↓
3. 柳田（弁護士またはADMIN）が承認
        ↓
4. アクセス権限を一時付与（時間制限付き）
        ↓
5. ZettAIが調査・対応
        ↓
6. アクセスログを記録
        ↓
7. 対応完了後、アクセス権限を削除
        ↓
8. 閲覧内容・対応結果を柳田に報告
```

---

## 6. 監査・異常検知

### 6-1. 監査ログの記録項目

| 項目 | 説明 |
|------|------|
| timestamp | 操作日時（ミリ秒精度） |
| user_id | 操作者のユーザーID |
| role | 操作者のロール |
| action | 操作内容（閲覧、承認、送信など） |
| target | 対象（案件ID、ドキュメントIDなど） |
| ip_address | 操作元IPアドレス |
| user_agent | ブラウザ情報 |
| result | 成功/失敗 |
| details | 詳細情報（変更内容など） |

### 6-2. 異常検知アラート

| 異常パターン | 検知条件 | アラート先 |
|-------------|---------|-----------|
| **オート承認疑い** | 開いてから5秒以内の承認 | LAWYER, ADMIN |
| **大量承認疑い** | 1分以内に10件以上承認 | LAWYER, ADMIN |
| **時間外アクセス** | 深夜・休日のアクセス | ADMIN |
| **異常IP** | 通常と異なるIPからのアクセス | 該当ユーザー, ADMIN |
| **権限外操作試行** | 権限のない操作の試行 | ADMIN, TECH_SUPPORT |
| **大量ダウンロード** | 短時間での大量資料ダウンロード | ADMIN |
| **ログイン失敗** | 連続5回以上のログイン失敗 | 該当ユーザー, ADMIN |

### 6-3. 定期監査ルール

**月次監査：**
- 承認ログのランダムサンプリング（10%）
- 承認までの時間、修正の有無を確認
- 異常パターンがないか点検

**四半期監査：**
- 全ユーザーのアクセス権限レビュー
- 不要なアカウントの棚卸し
- ロール割り当ての適正確認

**年次監査：**
- 外部監査（オプション）
- セキュリティ診断
- ペネトレーションテスト

---

## 7. ロール変更・退職時の手順

### 7-1. ロール変更

```
1. 変更申請（ADMIN → 弁護士承認）
        ↓
2. 現行権限での未完了タスク確認
        ↓
3. 担当案件の引き継ぎ
        ↓
4. ロール変更実行
        ↓
5. 変更ログの記録
```

### 7-2. 退職・契約終了時

**弁護士法人職員の場合：**
```
1. 退職通知
        ↓
2. 担当案件の引き継ぎ
        ↓
3. アカウント無効化（即時）
        ↓
4. アクセスログの保存
        ↓
5. 退職後30日でアカウント削除
```

**依頼者の場合：**
```
1. 案件終了
        ↓
2. 最終報告・書類交付
        ↓
3. アカウント継続（希望者）または無効化
        ↓
4. データ保存（10年間）
        ↓
5. 保存期間経過後、削除
```

---

## 8. 付録：権限設定コード例

### 8-1. ロール定義（疑似コード）

```typescript
enum Role {
  LAWYER = 'LAWYER',
  STAFF = 'STAFF',
  CLIENT = 'CLIENT',
  TECH_SUPPORT = 'TECH_SUPPORT',
  ADMIN = 'ADMIN'
}

enum Permission {
  // 案件関連
  CASE_VIEW_ALL = 'case:view:all',
  CASE_VIEW_ASSIGNED = 'case:view:assigned',
  CASE_VIEW_OWN = 'case:view:own',
  CASE_CREATE = 'case:create',

  // 承認関連
  DRAFT_VIEW = 'draft:view',
  DRAFT_APPROVE = 'draft:approve',
  DRAFT_MODIFY = 'draft:modify',

  // 送信関連
  SEND_LEGAL_RESPONSE = 'send:legal_response',
  SEND_CREDITOR_NOTICE = 'send:creditor_notice',
  SEND_COURT_DOCUMENT = 'send:court_document',
  SEND_ADMIN_MESSAGE = 'send:admin_message',

  // その他
  AUDIT_LOG_VIEW = 'audit:view',
  USER_MANAGE = 'user:manage',
  SYSTEM_CONFIG = 'system:config'
}

const RolePermissions: Record<Role, Permission[]> = {
  [Role.LAWYER]: [
    Permission.CASE_VIEW_ALL,
    Permission.CASE_CREATE,
    Permission.DRAFT_VIEW,
    Permission.DRAFT_APPROVE,
    Permission.DRAFT_MODIFY,
    Permission.SEND_LEGAL_RESPONSE,
    Permission.SEND_CREDITOR_NOTICE,
    Permission.SEND_COURT_DOCUMENT,
    Permission.SEND_ADMIN_MESSAGE,
    Permission.AUDIT_LOG_VIEW
  ],
  [Role.STAFF]: [
    Permission.CASE_VIEW_ASSIGNED,
    Permission.CASE_CREATE,
    Permission.SEND_ADMIN_MESSAGE
  ],
  [Role.CLIENT]: [
    Permission.CASE_VIEW_OWN
  ],
  [Role.TECH_SUPPORT]: [
    Permission.SYSTEM_CONFIG
    // AUDIT_LOG_VIEW は障害時のみ動的付与
  ],
  [Role.ADMIN]: [
    Permission.CASE_VIEW_ALL,
    Permission.AUDIT_LOG_VIEW,
    Permission.USER_MANAGE,
    Permission.SYSTEM_CONFIG
  ]
}
```

### 8-2. 送信ゲートのチェック（疑似コード）

```typescript
function canSend(user: User, sendType: SendType): boolean {
  // 弁護士ロールのみ法的送信が可能
  if (sendType === SendType.LEGAL_RESPONSE ||
      sendType === SendType.CREDITOR_NOTICE ||
      sendType === SendType.COURT_DOCUMENT) {
    return user.role === Role.LAWYER;
  }

  // 事務連絡は弁護士・事務職員が可能
  if (sendType === SendType.ADMIN_MESSAGE) {
    return user.role === Role.LAWYER || user.role === Role.STAFF;
  }

  return false;
}
```
